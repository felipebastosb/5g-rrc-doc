---
layout: post
title: "5G RRC"
categories: 5g
author:
- Felipe Bastos
- Alan Breno
- Kleysson Oliveira
meta: "Springfield"
---


## Visão Geral do 5G RCC



## Procedimentos

Em todos os procedimentos as mensagens RRC são sempre tratadas em sequencia de acordo com a ordem de chegada, ou seja, a próxima mensagem só será tratada após a finalização do precedimento anterior. Assim que uma mensagem de configuração for recebida os valores serão atualizados e a nova disposição dos recursos começará a ser utilizada.

#### Aquisição de informações do sistema

![Aquisição de informações do sistema](/assets/imgs/info_ac.png)

Diferentemente do LTE, no 5G NR os <i>meter information blocks (MIBs)</i> e os <i>system information blocks (SIBs)</i> são transmitidos periodicamente em broadcast independentemente da vontade dos usuários, porém alguns SIBs mais específicos são transmitidos apenas quando solicidados pelos usuarios, como mostrado na figura acima. Estas mensagem podem ser uteis para usuarios em qualquer um dos três estados do RRC e contem informações referente ao AS, NAS, e informações do posição.

Caso não ocorram mudanças nas informações um SIB pode continuar valido por até 3 horas. Indiferentemente do estado, as mensagens de MIB SIB1 devem ser sempre recebidas e armazenadas pelos usuarios, caso uma dessas mensagens não seja recebida o usuario deve considerar a celula como bloqueada. 

Abaixo temos o exemplo de uma mensagem MIB

```
-- ASN1START
-- TAG-MIB-START
MIB ::=                   SEQUENCE {
systemFrameNumber         BIT STRING (SIZE (6)),
subCarrierSpacingCommon   ENUMERATED {scs15or60, scs30or120},
ssb-SubcarrierOffset      INTEGER (0..15),
dmrs-TypeA-Position       ENUMERATED {pos2, pos3},
pdcch-ConfigSIB1          PDCCH-ConfigSIB1,
cellBarred                ENUMERATED {barred, notBarred},
intraFreqReselection      ENUMERATED {allowed, notAllowed},
spare                     BIT STRING (SIZE (1))
}
-- TAG-MIB-STOP
-- ASN1STOP

```

Já as mensagem de SIB, contem mais informações referentes a célula. Como a mensagem SIB1 abaixo que tem informações sobre acesso e alocação de recursos de uma célula.

```

-- ASN1START
-- TAG-SIB1-START
SIB1 ::=        SEQUENCE {
cellSelectionInfo         SEQUENCE {
q-RxLevMin                Q-RxLevMin,
q-RxLevMinOffset          INTEGER (1..8) OPTIONAL, -- Need S
q-RxLevMinSUL             Q-RxLevMin OPTIONAL, -- Need R
q-QualMin                 Q-QualMin OPTIONAL, -- Need S
q-QualMinOffset           INTEGER (1..8) OPTIONAL -- Need S
} OPTIONAL, -- Cond Standalone

cellAccessRelatedInfo     CellAccessRelatedInfo,
connEstFailureControl     ConnEstFailureControl OPTIONAL, -- Need R
si-SchedulingInfo         SI-SchedulingInfo OPTIONAL, -- Need R
servingCellConfigCommon   ServingCellConfigCommonSIB OPTIONAL, -- Need R
ims-EmergencySupport      ENUMERATED {true} OPTIONAL, -- Need R
eCallOverIMS-Support      ENUMERATED {true} OPTIONAL, -- Need R
ue-TimersAndConstants     UE-TimersAndConstants OPTIONAL, -- Need R
uac-BarringInfo         SEQUENCE {
uac-BarringForCommon      UAC-BarringPerCatList OPTIONAL, -- Need S
uac-BarringPerPLMN-List   UAC-BarringPerPLMN-List OPTIONAL, -- Need S
uac-BarringInfoSetList    UAC-BarringInfoSetList,
uac-AccessCategory1-SelectionAssistanceInfo CHOICE {
plmnCommon UAC-AccessCategory1-SelectionAssistanceInfo,
individualPLMNList SEQUENCE (SIZE (2..maxPLMN)) OF UAC-AccessCategory1-SelectionAssistanceInfo
} OPTIONAL -- Need S
} OPTIONAL, -- Need R
useFullResumeID           ENUMERATED {true} OPTIONAL, -- Need R
lateNonCriticalExtension  OCTET STRING OPTIONAL,
nonCriticalExtension      SIB1-v1610-IEs OPTIONAL
}
SIB1-v1610-IEs ::=              SEQUENCE {
idleModeMeasurementsEUTRA-r16   ENUMERATED{true} OPTIONAL, -- Need R
idleModeMeasurementsNR-r16      ENUMERATED{true} OPTIONAL, -- Need R
posSI-SchedulingInfo-r16        PosSI-SchedulingInfo-r16 OPTIONAL, -- Need R
nonCriticalExtension            SIB1-v1630-IEs OPTIONAL
}
SIB1-v1630-IEs ::=        SEQUENCE {
uac-BarringInfo-v1630         SEQUENCE {
uac-AC1-SelectAssistInfo-r16    SEQUENCE (SIZE (2..maxPLMN)) OF UAC-AC1-SelectAssistInfo-r16
} OPTIONAL, -- Need R
nonCriticalExtension SIB1-v1700-IEs OPTIONAL
}
SIB1-v1700-IEs ::=        SEQUENCE {
hsdn-Cell-r17             ENUMERATED {true} OPTIONAL, -- Need R
ue-TimersAndConstants-RemoteUE-r17 UE-TimersAndConstants-RemoteUE-r17 OPTIONAL, -- Need R
uac-BarringInfo-v1700         SEQUENCE {
uac-BarringInfoSetList-v1700 UAC-BarringInfoSetList-v1700 OPTIONAL -- Cond MINT
} 

```

#### Controle de acesso

No 5G NR a rede é que inicia ou finaliza a conexão RRC de um  usuário, inicialmente a conexão é feita sem criptografia e os usuários conseguem a penas realizar medições, que serão transmitidas somente após a conexão está criptografada. As variáveis <i>keySetChangeIndicator</i> e the <i>nextHopChainingCount</i> são usdas para definir as chaves que serão usadas tanto na estão radio base quanto no equipamento do usuário. Cada mensagem transmitida em cada <i>radio bearer</i> deve possuir um número único de contador que será usado ne criptografia da menssagem. Os valores definidos no RRC para selecionar os <i>radio bearer</i> são usados como entrada para o sistema de criptografia.

##### Pagin

![Aquisição de informações do sistema](/assets/imgs/pagin.png)

O pagin é um tipo de mensagem que a estação rádio base usa para informar os usuários que está disponivel para iniciar o processo de conexão RRC.

Abaixo temos um exemplo de mensagem de pagin

```
-- ASN1START
-- TAG-PAGING-START
Paging ::=                  SEQUENCE {
pagingRecordList            PagingRecordList OPTIONAL, -- Need N
lateNonCriticalExtension    OCTET STRING OPTIONAL,
nonCriticalExtension        Paging-v1700-IEs OPTIONAL
}
Paging-v1700-IEs ::=        SEQUENCE {
pagingRecordList-v1700      PagingRecordList-v1700 OPTIONAL, -- Need N
pagingGroupList-r17         PagingGroupList-r17 OPTIONAL,
nonCriticalExtension        SEQUENCE {} OPTIONAL
}
PagingRecordList ::=        SEQUENCE (SIZE(1..maxNrofPageRec)) OF PagingRecord
PagingRecordList-v1700 ::=  SEQUENCE (SIZE(1..maxNrofPageRec)) OF PagingRecord-v1700
PagingGroupList-r17 ::=     SEQUENCE (SIZE(1..maxNrofPageGroup-r17)) OF TMGI-r17
PagingRecord ::=            SEQUENCE {
ue-Identity                 PagingUE-Identity,
accessType                  ENUMERATED {non3GPP} OPTIONAL, -- Need N
...
}
PagingRecord-v1700 ::=      SEQUENCE {
pagingCause-r17             ENUMERATED {voice} OPTIONAL -- Need N
}
PagingUE-Identity ::=       CHOICE {
ng-5G-S-TMSI                NG-5G-S-TMSI,
fullI-RNTI                  I-RNTI-Value,
...
}
-- TAG-PAGING-STOP
-- ASN1STO
```

##### Conexão RRC

![Aquisição de informações do sistema](/assets/imgs/rrc_sucess.png)

![Aquisição de informações do sistema](/assets/imgs/rrc_fail.png)


Após receber o pagin da rede, o usuário pode fazer o pedido de conexão RRC para passar do estado de IDLE pra Ativo. Após receber o pedido a rede responde o usuário com as informação de configuração da rede (primeira figura) ou como uma mensagem recusando a conexão (segunda figura). Caso a conexão seja aceita, o usuário deve confirmar a rede que as configurações foram feitas com sucesso.

Como mostrado no padrão de mensagem abaixo, ao fazer o pedido de conexão o usuário deve informar qual a prioridade, além de informações de identificação.

```
- ASN1START
-- TAG-RRCSETUPREQUEST-START
RRCSetupRequest ::=     SEQUENCE {
rrcSetupRequest     RRCSetupRequest-IEs
}
RRCSetupRequest-IEs ::=     SEQUENCE {
ue-Identity                 InitialUE-Identity,
establishmentCause          EstablishmentCause,
spare                       BIT STRING (SIZE (1))
InitialUE-Identity ::=      CHOICE {
ng-5G-S-TMSI-Part1          BIT STRING (SIZE (39)),
randomValue                 BIT STRING (SIZE (39))
}
EstablishmentCause ::=      ENUMERATED {
emergency, highPriorityAccess, mt-Access, mo-Signalling,
mo-Data, mo-VoiceCall, mo-VideoCall, mo-SMS, mps-PriorityAccess, mcs-PriorityAccess,
spare6, spare5, spare4, spare3, spare2, spare1}
-- TAG-RRCSETUPREQUEST-STOP
-- ASN1STOP
```

Ao responder, a rede deve informar os <i>radio bearers</i>, assim como outras variáveis de configuração.


```
-- ASN1START
-- TAG-RRCSETUP-START
RRCSetup ::=                SEQUENCE {
rrc-TransactionIdentifier   RRC-TransactionIdentifier,
criticalExtensions          CHOICE {
rrcSetup RRCSetup-IEs,
criticalExtensionsFuture    SEQUENCE {}
}
}
RRCSetup-IEs ::=            SEQUENCE {
radioBearerConfig           RadioBearerConfig,
masterCellGroup             OCTET STRING (CONTAINING CellGroupConfig),
lateNonCriticalExtension    OCTET STRING OPTIONAL,
nonCriticalExtension        RRCSetup-v1700-IEs OPTIONAL
}
RRCSetup-v1700-IEs ::=      SEQUENCE {
sl-ConfigDedicatedNR-r17    SetupRelease {SL-ConfigDedicatedNR-r16 } OPTIONAL, -- Cond L2RemoteUE
sl-L2RemoteUEConfig-r17     SetupRelease {SL-L2RemoteUEConfig-r17 } OPTIONAL, -- Cond L2RemoteUE
nonCriticalExtension        SEQUENCE {} OPTIONAL
}
-- TAG-RRCSETUP-STOP
-- ASN1STOP
```